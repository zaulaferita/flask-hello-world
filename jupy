#@title RYZEN
# Install Jupyter Lab and other required packages
pip install jupyterlab jupyterlab-code-formatter jupyterlab-lsp python-lsp-server[all]

# Install ngrok to expose the Jupyter Lab server
pip install pyngrok

# Install Jupyter Lab extensions
jupyter labextension install @krassowski/jupyterlab-lsp
jupyter labextension install @ryantam626/jupyterlab_code_formatter

# Enable Jupyter Lab extensions
jupyter serverextension enable --py jupyterlab_code_formatter

# Generate Jupyter Lab configuration
jupyter lab --generate-config



# Configure Jupyter Lab to use the code formatter and language server
config_path = "/root/.jupyter/jupyter_lab_config.py"
with open(config_path, "a") as config_file:
    config_file.write("""
# Add the following lines to your jupyter_lab_config.py

c.ServerApp.port = 8888
c.ServerApp.open_browser = False
c.ServerApp.ip = '0.0.0.0'
c.ServerApp.allow_remote_access = True
c.ServerApp.token = ''  # No token authentication
c.ServerApp.password = ''  # No password authentication
c.LspInstallSettings.install_optional_dependencies = True

# Configure code formatter
c.CodeFormatter.formatters = {
    'python': ['black'],
}
""")

# Start ngrok
from pyngrok import ngrok

# Authenticate ngrok with your authtoken
ngrok.set_auth_token("2jhlKY4AwXDKSGfXqiCzNEi7q5A_2y3MWqmcBrnDAaJ2mcHZh")

# Kill any previous ngrok sessions if running
ngrok.kill()

# Set up a tunnel for the Jupyter Lab server
public_url = ngrok.connect(8888)
print(f"Jupyter Lab public URL: {public_url}")

# Start Jupyter Lab server
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root
